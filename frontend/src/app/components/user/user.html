<div class="user-details container py-4">
  <a routerLink="/admin/users" class="btn btn-sm btn-outline-dark mb-3">
    Back to Users
  </a>
  <div class="card user-card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        User: {{ userForm.value.username || usernameParam }}
      </h5>
      <span
        class="badge"
        [ngClass]="userActive ? 'bg-success' : 'bg-secondary'">
          {{ userActive ? 'Active' : 'Inactive' }}
      </span>
    </div>
    <div class="card-body">
      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>
      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>
      
      <!-- User details form -->
      <form [formGroup]="userForm" (ngSubmit)="onSaveUserDetails()">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" formControlName="username" />
          </div>
          <div class="col-md-4">
            <label class="form-label">Full name</label>
            <input type="text" class="form-control" formControlName="fullname" />
          </div>
          <div class="col-md-4">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" formControlName="email" />
          </div>
          <div class="col-md-3 mt-2">
            <label class="form-label d-block">Role</label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="adminCheckbox" formControlName="admin" />
              <label class="form-check-label" for="adminCheckbox">
                Admin user
              </label>
            </div>
          </div>
        </div>
        <div class="col-md-9 mt-2">
          <label class="form-label">Reason (optional)</label>
          <input type="text" class="form-control" formControlName="reason" placeholder="Reason for deactivation / reactivation" />
        </div>
        <div class="d-flex gap-2 mt-4">
          <button type="submit" class="btn btn-primary" [disabled]="isLoading || userForm.invalid">
            {{ isLoading ? 'Saving…' : 'Save Changes' }}
          </button>
          <button type="button" class="btn btn-outline-warning" (click)="userActive ? onDeactivate() : onReactivate()" [disabled]="isLoading">
            {{ userActive ? 'Deactivate User' : 'Reactivate User' }}
          </button>
          <button type="button" class="btn btn-outline-danger ms-auto" (click)="onDelete()" [disabled]="isLoading">
            Delete User
          </button>
        </div>
      </form>

      <hr class="my-4" />
      <!-- Password reset -->
      <form [formGroup]="passwordForm" (ngSubmit)="onResetPassword()">
        <h6>Reset Password</h6>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">New password</label>
            <input
              type="password"
              class="form-control"
              formControlName="new_password"
            />
          </div>
        
          <div class="col-md-4">
            <label class="form-label">Confirm new password</label>
            <input
              type="password"
              class="form-control"
              formControlName="confirm_password"
            />
          </div>
        
          <div class="col-md-4 d-flex align-items-end">
            <button
              type="submit"
              class="btn btn-outline-success ms-auto"
              [disabled]="isPasswordUpdating || passwordForm.invalid"
            >
              {{ isPasswordUpdating ? 'Updating…' : 'Reset Password' }}
            </button>
          </div>
        </div>
      </form>
  </div>
</div>