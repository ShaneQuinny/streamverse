<div class="home-page-wrapper">
  <!-- HERO SECTION -->
  <section class="home-hero">
    <div class="home-hero-overlay"></div>
    <div class="container home-hero-content">
      <div>
        <h1 class="display-4 fw-bold mb-3">StreamVerse</h1>
        <p class="lead mb-4">
          Discover, explore and review your favourite films and TV shows - all in one place.
        </p>
      </div>
    </div>
  </section>

  <div class="container home-main">
    <!-- WELCOME / AUTH PANEL -->
    <section class="mb-4">
      <div class="card home-panel-card">
        <div
          class="card-body d-flex flex-wrap justify-content-between align-items-center gap-3">
          <div>
            <h5 class="card-title mb-1">
              {{ isLoggedIn ? 'Welcome back' : 'Welcome to StreamVerse' }}
              <span *ngIf="isLoggedIn && currentUser">, {{ currentUser }}</span>
              <span *ngIf="isLoggedIn"></span>
            </h5>
            <p class="card-text mb-0">
              {{
                isLoggedIn
                  ? 'Jump straight into discovering and adding new titles or adding reviews.'
                  : 'Create an account to write reviews, add new titles and truly explore the StreamVerse!.'
              }}
            </p>
          </div>
          <div class="d-flex gap-2">
            <a routerLink="/titles" class="btn btn-outline-primary">
              Explore catalogue
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- STATS CARDS -->
    <section class="mb-4">
      <div class="row g-3">
        <div class="col-md-4">
          <div class="card home-stat-card">
            <div class="card-body">
              <h6 class="text-uppercase small mb-2 home-stat-label">
                Average IMDb Ratings
              </h6>
              <div *ngIf="isLoadingStats" class="placeholder-glow">
                <span class="placeholder col-6"></span>
              </div>
              <div *ngIf="!isLoadingStats && ratingStats">
                <div class="h3 mb-0 home-stat-value">
                  {{ ratingStats.avg_imdb_rating | number: '1.1-1' }}/10
                </div>
                <small class="text-muted">
                  Across {{ ratingStats.count }} titles
                </small>
              </div>
              <div *ngIf="statsError" class="text-danger small">
                {{ statsError }}
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card home-stat-card">
            <div class="card-body">
              <h6 class="text-uppercase small mb-2 home-stat-label">
                Average Rotten Tomatoes Ratings
              </h6>
              <div *ngIf="isLoadingStats" class="placeholder-glow">
                <span class="placeholder col-6"></span>
              </div>
              <div *ngIf="!isLoadingStats && ratingStats">
                <div class="h3 mb-0 home-stat-value">
                  {{ ratingStats.avg_rotten_tomatoes | number: '1.0-0' }}%
                </div>
                <small class="text-muted">
                  Across {{ ratingStats.count }} titles
                </small>
              </div>
              <div *ngIf="statsError" class="text-danger small">
                {{ statsError }}
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card home-stat-card">
            <div class="card-body">
              <h6 class="text-uppercase small mb-2 home-stat-label">
                Titles in StreamVerse
              </h6>
              <div *ngIf="isLoadingStats" class="placeholder-glow">
                <span class="placeholder col-4"></span>
              </div>
              <div *ngIf="!isLoadingStats && ratingStats">
                <div class="h3 mb-0 home-stat-value">
                  {{ ratingStats.count | number: '1.0-0' }}
                </div>
                <small class="text-muted">Curated from your dataset</small>
              </div>
              <div *ngIf="statsError" class="text-danger small">
                {{ statsError }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TOP GENRES + TOP REVIEWED -->
    <section class="mb-5">
      <div class="row g-4">
        <!-- Top genres -->
        <div class="col-lg-6">
          <div class="card home-panel-card h-100">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="card-title mb-0">Popular genres</h5>
              </div>
              <p class="text-muted small mb-3">
                Genres with the most titles in the current catalogue.
              </p>
              <div *ngIf="isLoadingGenres" class="placeholder-glow">
                <span class="placeholder col-12"></span>
              </div>
              <div
                *ngIf="!isLoadingGenres && topGenres.length > 0"
                class="d-flex flex-wrap gap-2">
                <span
                  *ngFor="let genre of topGenres"
                  class="badge rounded-pill home-genre-pill">
                    {{ genre._id }} ({{ genre.count }})
                </span>
              </div>

              <div
                *ngIf="!isLoadingGenres && topGenres.length === 0 && !genresError" class="text-muted small">
                  No genre statistics available yet.
              </div>
              <div *ngIf="genresError" class="text-danger small">
                {{ genresError }}
              </div>
            </div>
          </div>
        </div>

        <!-- Top reviewed titles -->
        <div class="col-lg-6">
          <div class="card home-panel-card h-100">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="card-title mb-0">Most reviewed titles</h5>
              </div>
              <p class="text-muted small mb-3">
                Titles with the highest number of reviews in StreamVerse.
              </p>
              <div *ngIf="isLoadingTopReviewed" class="placeholder-glow">
                <span class="placeholder col-12"></span>
              </div>
              <ul
                *ngIf="!isLoadingTopReviewed && topReviewedTitles.length > 0" class="list-group list-group-flush home-list-group">
                <li
                  *ngFor="let t of topReviewedTitles"
                  class="list-group-item d-flex justify-content-between align-items-center home-title-item"
                  [routerLink]="['/titles', t._id]">
                  <span class="home-title-name">{{ t.title }}</span>
                  <span class="badge bg-primary rounded-pill">
                    {{ t.review_count }} review{{
                      t.review_count === 1 ? '' : 's'
                    }}
                  </span>
                </li>
              </ul>

              <div
                *ngIf="
                  !isLoadingTopReviewed &&
                  topReviewedTitles.length === 0 &&
                  !topReviewedError
                "
                class="text-muted small"
              >
                No reviews have been recorded yet.
              </div>

              <div *ngIf="topReviewedError" class="text-danger small">
                {{ topReviewedError }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="home-footer text-muted small">
    <span
        >StreamVerse - CW2
    </span>
    </footer>
  </div>
</div>